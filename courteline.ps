%!PS

/cm { 28.346 mul } bind def % conversion point -> cm

% distances
/marge    1.5 cm def
/largeur 21.0 cm def
/hauteur 29.7 cm def

/taille-titre   25 def
/taille-echelle 13 def

/cloison        {  5 setlinewidth } bind def % largeur des cloisons
/cloison-double { 10 setlinewidth } bind def % largeur des cloisons doubles
/mur-porteur        { 18 setlinewidth } bind def % largeur des murs mur-porteurs

/debug false def

% utilitaires

% passage en ISOLatin-1 (pour accents corrects)
% pris dans Red Book [en p.275, fr p.284]
/convert2latin1 { % <font-name> convert2latin1 -
  % calcule le nouveau nom
  dup dup dup dup
  length string cvs
  exch length 10 add dup string dup 3 -1 roll 10 sub (-ISOLatin1) putinterval
  dup 3 1 roll exch 0 exch  putinterval cvn
  % change l'encodage
  exch dup findfont
  dup length dict
  begin
    { 1 index /FID ne {def} {pop pop} ifelse } forall
    /Encoding ISOLatin1Encoding def
    currentdict
  end
  definefont pop
  def
} bind def

/Helvetica      convert2latin1
/Helvetica-Bold convert2latin1

/grille { % grille -
  gsave
    1 setlinewidth
    0.80 setgray
    2 {
      100 { 0 0 moveto 0 1000 rlineto 10 0 translate } repeat
      90 rotate
    } repeat
    stroke
  grestore
} def

/titre   { % <string> titre -
  gsave
    marge hauteur marge sub taille-titre sub moveto
    /Helvetica-Bold taille-titre selectfont show
    marge marge moveto
    debug {
      [ 5 2 2 2 ] 0 setdash
      0 hauteur marge 2 mul  sub rlineto
      largeur marge 2 mul sub 0 rlineto
      0 hauteur marge 2 mul sub neg rlineto
      closepath
      stroke
    } if
  grestore
} bind def

/echelle { % <echelle> echelle -
  gsave
    largeur marge sub hauteur marge sub taille-titre sub translate
    dup 1 cm div 10000 mul round 100 div 6 string cvs exch % ratio
    /Helvetica taille-echelle selectfont
    gsave
      dup scale
      1 setlinewidth
      0.2 setgray
      0 0 moveto -100.5 0 rlineto
      0 10 rlineto 10 -10 rmoveto currentpoint stroke moveto
      9 {
        0 7 rlineto 10 -7 rmoveto
      } repeat
      0 10 rlineto 10 -10 rmoveto
      stroke
    grestore
    0 taille-echelle 1.1 mul neg moveto
    dup stringwidth pop
    ( cm = 1 m) dup stringwidth pop 3 -1 roll add
    (1 carré = 10 cm, ) dup stringwidth pop 3 -1 roll add
    neg 0 rmoveto
    show exch show show
    stroke
  grestore
} def

% pièces

/salle-de-bain {
  gsave
    show-grille {
       -5    0 moveto
        0  203 rlineto
      310    0 rlineto
        0 -203 rlineto
      clip newpath
      0 0 moveto grille
      cliprestore
    } if

    -2.5 0 moveto
    cloison 0 185 rlineto
    currentpoint stroke moveto
    -2.5 9 rmoveto
    mur-porteur 310 0 rlineto stroke

    0 150 2.5 add moveto
    cloison 85 0 rlineto
    currentpoint stroke moveto
    2.5 -2.5 rmoveto
    0 35 rlineto stroke

    305 185 moveto
    -2.5 0 rmoveto
    0 -185 rlineto
    stroke

    1 setlinewidth
    -5 0 moveto
    310 0 rlineto stroke

  grestore
} def

/salle-de-bain+wc {
  gsave
    show-grille {
       -5    0 moveto
        0  203 rlineto
      320    0 rlineto
        0 -203 rlineto
      clip newpath
      0 0 moveto grille
      cliprestore
    } if

    -2.5 0 moveto
    cloison 0 185 rlineto
    currentpoint stroke moveto
    -5.5 9 rmoveto
    mur-porteur 331 0 rlineto stroke

    90 2.5 add 0 moveto
    cloison 0 185 rlineto

    315 185 moveto
    -2.5 0 rmoveto
    0 -185 rlineto
    stroke

    1 setlinewidth
    -5 0 moveto
    320 0 rlineto stroke

  grestore
} def

/cuisine {
  gsave
     -5    0 moveto
      0  280 rlineto
    515    0 rlineto
      0 -280 rlineto
    clip newpath
    0 0 moveto show-grille { grille } if
    cliprestore

    -5 0 moveto
    cloison-double 0 280 rlineto currentpoint stroke
    moveto -8 9 rmoveto
    mur-porteur 345 0 rlineto
    150 0 rmoveto
    30 0 rlineto
    30 -280 -18 add rmoveto
    -367 0 rlineto stroke

    cloison-double 502 5 add 0 moveto
    0 270 rlineto stroke
    cloison 502 10 add 270 2.5 add moveto
    -23 0 rlineto

    stroke
  grestore
} def

/bac-a-fleurs {
  gsave
    1 setlinewidth
    0 0 moveto 0 264 rlineto 50 0 rlineto 0 -264 rlineto -50 0 rlineto
    7 7 moveto 0 250 rlineto 36 0 rlineto 0 -250 rlineto -36 0 rlineto
    gsave 1 setgray fill grestore
    stroke
  grestore
} def

/terrasse {
  gsave
    show-grille {
        0   0  moveto
        0  280 rlineto
      550    0 rlineto
        0 -280 rlineto
      clip newpath
      grille
      cliprestore
    } if
    gsave -20 8 translate bac-a-fleurs grestore
    gsave 1188 8 translate bac-a-fleurs grestore
    mur-porteur
    0 -9  moveto 70 0 rlineto 95 0 rmoveto 128 0 rlineto 310 0 rmoveto
                450 0 rlineto 95 0 rmoveto  70 0 rlineto stroke
    0 289 moveto 1218 0 rlineto stroke
  grestore
} def

/chambre-4 {
  gsave
    show-grille {
        0   0  moveto
        0  280 rlineto
      538    0 rlineto
        0 -280 rlineto
      clip newpath
      grille
      cliprestore
    } if
    mur-porteur
    -50 -9 moveto 405 0 rlineto 90 0 rmoveto 113 0 rlineto
    -19 140 moveto 0 140 rlineto
    -28 289 moveto 388 0 rlineto 83 0 rmoveto 113 0 rlineto
    stroke
    cloison
    -2.5 145 moveto 0 130 rlineto
     0 272.5 moveto 355 0 rlineto 93 0 rmoveto 88 0 rlineto
    536 2.5 add 0 moveto 0 280 rlineto
    stroke
  grestore
} def

/chambre-5 {
  gsave
    show-grille {
        0   0  moveto
        0  280 rlineto
      550    0 rlineto
        0 -280 rlineto
      clip newpath
      grille
      cliprestore
    } if
    gsave -20 8 translate bac-a-fleurs grestore
    mur-porteur
    0 -9  moveto 575 0 rlineto
    0 289 moveto 555 0 rlineto stroke
    200 0 translate
    cloison-double
    -5 80 moveto 0 200 rlineto stroke
    cloison
    347 2.5 add 80 moveto 0 200 rlineto stroke
  grestore
} def

% document

/show-grille false def

(Plan d'ensemble) titre
1 cm 100 1 div div dup echelle

gsave
  marge dup translate
  dup scale
  0 20 translate
  90 rotate
  0 298 4 mul 36 add neg translate
  gsave  358  930 translate terrasse         grestore
  gsave  200  316 translate chambre-4        grestore
  gsave    0   18 translate chambre-5        grestore
  gsave  673  113 translate salle-de-bain+wc grestore
  gsave 1229  316 translate cuisine          grestore
  gsave 1453  113 translate salle-de-bain    grestore
grestore

showpage

/show-grille true def

(Cuisine) titre
1 cm 100 4.5 div div dup echelle

gsave
  marge dup translate
  90 rotate
  dup scale
  13 -280 -18 add translate
  cuisine
grestore

showpage

(Salle de bain) titre
1 cm 100 7 div div dup echelle

gsave
  marge dup translate
  90 rotate
  dup scale
  5 -203 translate
  salle-de-bain
grestore

showpage

(Salle de bain + WC) titre
1 cm 100 7 div div dup echelle

gsave
  marge dup translate
  90 rotate
  dup scale
  8 -203 translate
  salle-de-bain+wc
grestore

showpage

(Salles de bain) titre
1 cm 100 5 div div dup echelle

gsave
  marge dup translate
  dup scale
  8 0 translate
  salle-de-bain+wc
  0 250 translate
  salle-de-bain
grestore

showpage

(Chambre 4) titre
1 cm 100 4 div div dup echelle
gsave
  marge dup translate
  dup scale
  -90 rotate
  -556 18 translate
  chambre-4
grestore

showpage

(Chambre 5) titre
1 cm 100 4 div div dup echelle
gsave
  marge dup translate
  dup scale
  -90 rotate
  -575 18 translate
  chambre-5
grestore

showpage
